<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function($scope, $location,$rootScope,spUtil, spModal,spAriaFocusManager) {
	
	var c = this;
	
	c.refresh = function(){
		$scope.server.update()
	}
	if($location.search().activeTab === undefined ){
		c.activeTab = 'tab0';
	}else{
			c.activeTab = 'tab'+$location.search().activeTab ;
	}
	if(c.data.role == false){
		c.activeTab = 'tab2'
	}
		$scope.$on('data_table.click', function(e, parms){
		var activeIndex = c.activeTab.substring(3);
		var view = $scope.data.tabs[activeIndex].view;
		var p = $scope.data.tabs[activeIndex].page_id;
			
		var s = {activeTab: activeIndex, id: p, table: parms.table, sys_id: parms.sys_id, view: view};
			var newURL = $location.search(s);
			spAriaFocusManager.navigateToLink(newURL.url());
			c.activeTab = 'tab' + activeIndex;
		});
		var tab={className: "active"};
	
	/*$scope.$on('data_table.click', function(e, parms) {
		var oid = $location.search().id;
		var activeIndex = c.activeTab.substring(3);
		var view = $scope.data.tabs[activeIndex].view;
		var p = $scope.data.tabs[activeIndex].page_id;
		var s = {id: p, table: parms.table, sys_id: parms.sys_id, view: view};
		if (oid == p) {
			s.spa = 1;
			var t = $location.search();
			s = angular.extend(t, s);
			$rootScope.$broadcast('$sp.list.click', s);
		}

		var newURL = $location.search(s);
		spAriaFocusManager.navigateToLink(newURL.url());
	});
	*/
			$scope.openModalNewPocessTemplate= function(sys_id_Modal) {
	
		var table = 'x_153465_discovert_discover_routing_template';
		spModal.open({
					title: 'New Process Template',
					widget: 'discovertasker-formtab', 
					widgetInput: {table: table, sys_id: "-1", view: 'Create_View', query: "parent="+sys_id_Modal},
					size: 'lg',
					buttons: []
				})
	}
		c.showTab = function(tab, e){
			c.activeTab = tab;
			target = e.target ;
			$(target).parents('.nav-tabs').find('li').removeClass('active');
			$(target).parents('li').addClass('active');
			$rootScope.$broadcast("declareActiveTab",c.activeTab);

		};

	}]]></client_script>
        <controller_as>c</controller_as>
        <css>div.panel.panel-.widget-toggle.csm-widget.cm-right-pane{
	padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
}
.label {
	margin-left: 5px;
}

.panel {
	border: 0px solid transparent;

}.panel-body {
  padding: 0px!important;
  margin-bottom: 10px!important;
}

.panel-heading,
div.panel-heading.cm-widget-tabs{
	padding: 5px!important;
  //margin-top: 10px!important;
}

.nav-tabs {
    //border-bottom: 0px!important;
}

.glyphicon-envelope:before {
    margin: 0 16px!important;
}


li.hover-effect.cm-subs-tab.active {
  border-left: 0px solid #ddd!important;
}



//----------------------------------------------------------------------------------------------------------
.widget-data-table .clearfix{
	display: none;
} 
 
  .cm-right-pane {
    .cm-widget-tabs {
      //padding: 15px 0px 0px;
      .nav-tabs {
        border-bottom: 1px solid #ddd;
        margin-bottom: -1px;
      }     
      .nav-tabs &gt; li {
        padding: 0px 30px;
        font-family: SourceSansPro, Helvetica, Arial, sans-serif;
    		font-size: 14px;
        font-weight: 500;
        letter-spacing: 0;
   			line-height: 16px;
      }
      .nav-tabs &gt; li.widget-collapse {
        padding-right: 0px;
      }
      .nav-tabs  &gt; li:not(:last-of-type){
         //margin-right: 20px;
      }
      .nav-tabs  &gt; li  &gt; a {
        border: none;
        padding: 10px 10px 15px 10px;
      }
      .nav-tabs  &gt; li.active {
        border-bottom: 3px solid $link-color;
        font-weight: 550;
        a {
          color: $brand-primary;
        }
      }
      .nav-tabs  &gt; li.active &gt; a {
        background-color: inherit;
      }

      .hover-effect:hover {
        background-color: initial;
        border-bottom: 2px solid $link-color;
        cursor: pointer;
        //#x9ff58c48db8c6f00bb8ee536ca9619a0 &gt; div &gt; div &gt; div.panel-heading.cm-widget-tabs &gt; ul &gt; li.hover-effect.cm-subs-tab.active
      }
    }
  }
    .cm-widget-body {
      //padding-top: 20px;
      padding-left: 0px;
      padding-right: 0px;
      padding-bottom: 0px;      
    } 

//----------------------------------------------------------------------------------------------------------
.cm-right-pane .cm-widget-tabs .nav-tabs &gt; li {
    padding: 0px 0px 0px 0px; 
  	width: 200px;
}

.cm-right-pane .cm-widget-tabs .nav-tabs &gt; li.active {
    //border-bottom: 2px solid #004475;
    border-radius: 10px 10px 4px 4px;
}

.cm-right-pane .cm-widget-tabs .nav-tabs &gt; li.active &gt; a {
	color: #2E3C54!important;
}

.cm-right-pane .cm-widget-tabs .nav-tabs &gt; li &gt; a {
	color: #5f6368!important;
}  
	.bs-example{
		margin: 20px;
	}

</css>
        <data_table>sp_instance_table</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list>sp_page</field_list>
        <has_preview>false</has_preview>
        <id>discovertasker-listtabbed</id>
        <internal>false</internal>
        <link/>
        <name>Tasker List Tabbed</name>
        <option_schema>[{"hint":"?table=incident&amp;filter=caller_id=javascript:gs.getUserID()^active=true&amp;title=Incidents&amp;view=sp","name":"link1","section":"Behavior","default_value":"?table=incident&amp;title=Incidents&amp;page=ticket&amp;view=sp&amp;filter=caller_id=javascript:gs.getUserID()^active=true&amp;enable_filter=true&amp;show_new=true&amp;show_keywords=true&amp;show_breadcrumbs=true&amp;o=number&amp;d=desc&amp;p=1","label":"Tab 1 link","type":"string"},{"hint":"?table=sc_request&amp;title=Requests&amp;page=sc_request&amp;filter=requested_for=javascript:gs.getUserID()^active=true","name":"link2","section":"Behavior","default_value":"?table=sc_request&amp;title=Requests&amp;page=sc_request&amp;filter=requested_for=javascript:gs.getUserID()^active=true&amp;page=sc_request","label":"Tab 2 link","type":"string"},{"hint":"?table=incident&amp;title=Incidents&amp;filter=caller_id=javascript:gs.getUserID()&amp;o=number&amp;d=desc","name":"link3","section":"Behavior","label":"Tab 3 link","type":"string"},{"hint":"?table=incident&amp;title=Incidents&amp;show_keywords=true&amp;enable_filter=true&amp;page=ticket","name":"link4","section":"Behavior","label":"Tab 4 link","type":"string"},{"hint":"?table=incident&amp;title=Incidents&amp;show_new=true&amp;show_breadcrumbs=true&amp;p=1","name":"link5","section":"Behavior","default_value":"","label":"Tab 5 link","type":"string"}]</option_schema>
        <public>false</public>
        <roles>x_153465_discovert.tasker_user</roles>
        <script><![CDATA[//------------------------------------------------------------------------------------------------------------------------
// COMPANY: DISCOVER TECHNOLOGIES
// UPDATED BY: KARINA TORRES
//------------------------------------------------------------------------------------------------------------------------
(function(data) {
	var sp_page = $sp.getValue('sp_page');
	var pageGR = new GlideRecordSecure('sp_page');
	pageGR.get(sp_page);
	data.page_id = "";//pageGR.id.getDisplayValue();
	data.showInactiveProcess = false;
	if(input)
	data.showInactiveProcess = input.showInactiveProcess;
	/*
	$sp.getValues(data);
	if (data.field_list) {
		data.fields_array = data.field_list.split(',');
	}
 	*/
	data.p = data.p || 1;
	data.page_index = (data.p - 1);
	data.window_size = $sp.getValue('maximum_entries') || 10;
	data.window_start  = (data.page_index * data.window_size);
	data.window_end = (((data.page_index + 1) * data.window_size));
	
	var link = '';
	var widgetParams;
	var tabs = [];
	/*to add more tabs,
	1. Create new instance option(eg. link6)
	2. include option to below array
	var links = ['link1','link2','link3','link4','link5','link6'];
 	*/
	var links = ['link1','link2','link3','link4','link5'];
	for(var i=0;i<links.length;i++){
		link = options[links[i]];
		if(link){
			var tab = {};
				widgetParams = getTabData(link) ;
				if(widgetParams.table){
					tab.table = widgetParams.table;
					tab.tabTitle = widgetParams.title;
					tab.filter = widgetParams.filter;
					tab.view = widgetParams.view;
					tab.page_id = widgetParams.page_id;
					tab.tabName = 'tab'+i;
					tab.role = widgetParams.role; 
					
					//KTORRES: CONTROL SECURITY PER TAB
					
					//role=x_153465_discovert.tasker_process_template_global
					//role=x_153465_discovert.tasker_process_template_ou
					//role=x_153465_discovert.tasker_process_template_user
					var currentUser = gs.getUser(); 
					if (tab.role == 'x_153465_discovert.tasker_process_template_global' || tab.role == 'x_153465_discovert.tasker_process_template_ou') {
						
							var indexRole = currentUser.getRoles().indexOf('x_153465_discovert.tasker_process_template_ou');
							if (indexRole > -1)  tab.visible = true; else tab.visible = false; 
					}
						if (tab.role == 'x_153465_discovert.tasker_process_template_user') {
							var indexRole = currentUser.getRoles().indexOf('x_153465_discovert.tasker_process_template_user');
							if (indexRole > -1)  tab.visible = true; else tab.visible = false; 
							tab.className="active";
					}
					
					tab.count = getTableCountbyFilter(tab.table, tab.filter);
					tab.className = '';
					tab.dataTableWidget = $sp.getWidget('discovertasker-widget-data-table', widgetParams);//widget-data-table
					if (tab.visible)
					tabs.push(tab);
				}
			}
		}
		if ( tabs.length > 0 )
		tabs[0].className = 'active';
		data.tabs = tabs ;
	
	
		 data.role = gs.hasRole('x_153465_discovert.tasker_process_template_global');
	
		
		function getTabData(link){
			var table = getParameterByName(link,'table');
			var view = getParameterByName(link,'view') || 'sp';
			if(!table){
				return;
			}
			
			
			var widgetParams = {
				table: table,
				o: getParameterByName(link,'o') || $sp.getValue('order_by'),
				d: getParameterByName(link,'d') || $sp.getValue('order_direction'),
				p: getParameterByName(link,'p') || 1,
				view: view,
				fields: $sp.getListColumns(table,view),
				page_id: getParameterByName(link,'page') || data.page_id || 'form',
				show_keywords: getParameterByName(link,'show_keywords'),
				show_breadcrumbs: getParameterByName(link,'show_breadcrumbs'),
				show_new: getParameterByName(link,'show_new'),
				filter: getParameterByName(link,'filter'),
				enable_filter:getParameterByName(link,'enable_filter'),
				window_size: data.window_size,
				title: gs.getMessage(getParameterByName(link,'title')),
				role: gs.getMessage(getParameterByName(link,'role')),
				showInactiveProcess: data.showInactiveProcess
			};
			return widgetParams ;
		}
		function getParameterByName(url,name) {
			name = name.replace(/[\[\]]/g, "\\$&");
			var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
			results = regex.exec(url);
			if (!results) return null;
				if (!results[2]) return '';
				return decodeURIComponent(results[2].replace(/\+/g, " "));
		}
	
	
		function getTableCountbyFilter(table,filter){
			var count;
			var ga = new GlideAggregate(table);
			ga.addEncodedQuery(filter);
			ga.addAggregate('COUNT');
			
			// only count active processes
			if (table == 'x_153465_discovert_discover_routing_template' && data.showInactiveProcess != true){
							ga.addQuery('u_active',true)
			}
			ga.query();
					
			if(ga.next()){
				count  = parseInt(ga.getAggregate('COUNT'));		
			}
			if (ga == null)
				return;
			else return count;
		}
	
	
	})(data);]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>kTorres</sys_created_by>
        <sys_created_on>2018-03-01 03:31:15</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>a86fe00a4fe89700303dc3818110c704</sys_id>
        <sys_mod_count>753</sys_mod_count>
        <sys_name>Tasker List Tabbed</sys_name>
        <sys_package display_value="Tasker" source="x_153465_discovert">c6b1162d4fc10300303dc3818110c7b1</sys_package>
        <sys_policy>protected</sys_policy>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Tasker">c6b1162d4fc10300303dc3818110c7b1</sys_scope>
        <sys_update_name>sp_widget_a86fe00a4fe89700303dc3818110c704</sys_update_name>
        <sys_updated_by>aalzyoud</sys_updated_by>
        <sys_updated_on>2019-04-06 10:27:26</sys_updated_on>
        <template><![CDATA[<div>
 <div class="panel panel-{{::options.panel_type}} widget-toggle csm-widget cm-right-pane">
	<input type="checkbox" ng-model="data.showInactiveProcess"> Show Inactive Process 
   <span class="glyphicon glyphicon-refresh" aria-hidden="true" ng-click="c.refresh()"></span>

   <div class="panel-heading cm-widget-tabs" role="tabpanel">
          <ul class="nav nav-tabs">
            <!--{{tab.className}}-->
            <li role="tab" ng-repeat="tab in data.tabs" class="hover-effect cm-subs-tab {{tab.className}}" ng-if="tab.dataTableWidget" ng-click="c.showTab(tab.tabName, $event)">
              <a class="csm-link-disabled" tabindex="{{$index}}">
                <!--span class="glyphicon glyphicon-envelope"></span-->
                {{::tab.tabTitle}}
                <span ng-if="tab.count > 0" class="label label-success">{{::tab.count}}</span>
                <!--span class="badge">7</span-->
              </a>
            </li>                
          </ul>
     </div>            
    <div class="panel-body cm-widget-body">
			<div class="cm-tab-content" ng-repeat="tab in data.tabs" ng-hide="c.activeTab!= tab.tabName">            
					<div ng-if="tab.dataTableWidget">
      				<sp-widget widget="tab.dataTableWidget"></sp-widget>
            	<a ng-click="openModalNewPocessTemplate(data.sys_id)"  class="btn btn-primary action-btn pull-right ng-scope" role="button">New</a>
          </div>             
      </div>            
    </div>
  </div>
</div>
<!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>-->
<script> 

</script>]]></template>
    </sp_widget>
</record_update>
