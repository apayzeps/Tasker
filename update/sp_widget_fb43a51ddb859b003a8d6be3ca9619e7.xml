<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function ($scope, $rootScope,spAriaFocusManager, $http, amb,$timeout, spUtil, $location, $window, nowAttachmentHandler, $log, spAriaUtil, spModal, $uibModal, spNavStateManager) {
	var c = this;
	c.allowSubTask = false;
	$scope.submitting = false;
  $scope.mandatory = [];
  $scope.errorMessages = [];
  $scope.data.show_sql = false;
  $scope.saveButtonSuffix = spUtil.getAccelerator('s');
	$scope.isPageReady = false;
	
	
  $scope.adminMenu = {
    encodedPageUrl: encodeURIComponent($location.url()),
    getClientScriptCount: function() {
      var count = 0;
      if ($scope.data.f.client_script) {
        count += $scope.data.f.client_script.onChange.length;
        count += $scope.data.f.client_script.onLoad.length;
        count += $scope.data.f.client_script.onSubmit.length;
      }
      return count;
    }
  };

	canCrateSubTask();
	addActiveCssClass();
	
	//----------
	// Event Listeners/Broadcasters
	// ----------
	
	$rootScope.$on('$sp.html.editor.progress', function(e, conf) {
      $scope.submitting = conf.state;
  });
	
	$rootScope.$broadcast('sp.update.breadcrumbs', $scope.data.breadcrumbs);
	
	spUtil.recordWatch($scope, "x_153465_discovert_tasker_schedule", "name!=''", function(name, data) {
    $scope.server.update();

    setTimeout(function() {
        $(".modal-dialog .nav-tabs li:nth-child(2)")
            .addClass("active");
        $("#x_153465_discovert_tasker_schedule")
            .addClass("active");

    }, 1000);

	});

	// KTORRES: FOR THE RELATED LIST TO REFRESH THE URL 
	$scope.$on('data_table.click', function(e, parms) {
			//var p = $scope.data.page_id || 'form';
			var p = $scope.data.page_id;
			var s = {
					id: p,
					table: parms.table,
					sys_id: parms.sys_id,
					view: 'sp',
					show_breadcrumbs: true
			};
			var newURL = $location.search(s);
			spAriaFocusManager.navigateToLink(newURL.url());
	});
	
	//	----------
	// CUSTOM Functions
	// -----------
	
	function canCrateSubTask(){
		
		if(c.data.table == 'x_153465_discovert_route_task_instance'){
			if(c.data.f._fields != undefined){
				if(((c.data.f._fields.originator.value == c.data.current_user) || (c.data.f._fields.assigned_to.value == c.data.current_user)) && (c.data.f._fields.active.value == 'true')){
				

					c.allowSubTask = true;
				}
			}
		}
	}
	
	
	function addActiveCssClass(){
		if ($scope.data.page_id == 'discovertasker_officehierarchy' || 'discovertasker_processtemplatedetails') {
			$scope.$on('$sp.list.click', function() {
					$(".nav-tabs li")
							.removeClass("active");
					$(".nav-tabs li:first-child")
							.addClass("active");
					$(".tab-content div")
							.removeClass("active");
					$(".tab-content div:first-child")
							.addClass("active");
			})
	}
	if ($scope.data.page_id == 'discovertasker_detailsdrilldown') {
			$scope.$on('$sp.list.click', function() {
					$(".nav-tabs li:nth-child(1)")
							.addClass("active");
					$(".tab-content div:nth-child(1)")
							.addClass("active");
					$(".nav-tabs li:nth-child(4)")
							.removeClass("active");
					$(".nav-tabs li:nth-child(2)")
							.removeClass("active");
					$(".nav-tabs li:nth-child(3)")
							.removeClass("active");
			})
	}
	}


	$scope.openNewModal = function(table,title,view,query,sys_id){
		var formQuery = query + sys_id;
		spModal.open({
			title: title,
			widget: 'discovertasker-formtab',
			widgetInput: {table: table, sys_id: "-1", view: view, query: formQuery},
			size:'lg',
			buttons:[]
		})
	}	
	
	$scope.openProcessPrompt = function(){
        spModal.prompt("Please enter a process instance notation to identify the purpose of this process instance.").then(function(name) {
            c.data.processInstanceName =  name;
							c.server.update();
					 spModal.alert('Tasker is running your process template');
    });
	}
	

	//------------------------------------------------------------------------------------------------------------------------
	// END CUSTOM
	//------------------------------------------------------------------------------------------------------------------------

	$scope.getUIActions = function(type) {
			if ($scope.data.disableUIActions)
					return [];
			if (type) {
					return $scope.data.f._ui_actions.filter(function(action) {
							//We handle the primary action button separately.
							return !action.primary && action['is_' + type];
					});
			} else {
					return $scope.data.f._ui_actions;
			}
	}
	
	c.thisPage =$location.search()['id'];
	
	$scope.getPrimaryAction = function() {
			var primaryActions = $scope.data.f._ui_actions.filter(function(action) {

					return action.primary;
			});
			return (primaryActions.length) ? primaryActions[0] : null;
	}

	$scope.getUIActionContextMenu = function(event) {
			var menu = [];
			if (event.ctrlKey)
					return menu;

			var contextActions = $scope.getUIActions('context');
			contextActions.forEach(function(action) {
					menu.push([action.name, function() {
							$scope.triggerUIAction(action);
					}]);
			});

			if (contextActions.length > 0)
					menu.push(null);
			menu.push([$scope.data.exportPDFMsg, function() {
					exportPDF("");
			}]);
			menu.push([$scope.data.exportPDFLandMsg, function() {
					exportPDF('true');
			}]);

			return menu;
	}

	function exportPDF(landscape) {
			$window.open("/" + $scope.data.f.table + ".do?PDF&landscape=" + landscape + "&sys_id=" + $scope.data.sys_id + "&sysparm_view=" + $scope.data.f.view);
	}	

	//trigger the primary UI Action on save (if there is one)
	var deregister = $scope.$on('$sp.save', function() {
		var primaryAction = $scope.getPrimaryAction();
		if (primaryAction)
			$scope.triggerUIAction(primaryAction);
	});
	$scope.$on('$destroy', function() {deregister()});

	$scope.triggerUIAction = function(action) {
		if ($scope.data.disableUIActions && !action.primary) {
			return;
		}

		$rootScope.$broadcast('sp.form.ui_action.triggered');
		if(action.action_name == 'createSchedule'){
			$('button[gsft_id="9a33e9b6db6e6380bb8ee536ca96190d"]').remove();
		//	$('.modal[index=1]').click();
		//	spModal.close();
		//	$('.modal[index != 0]').remove();			
			//$('.modal-backdrop').css( "z-index", "1040" );
			//$('body').removeClass('modal-open');
		}

		var activeElement = document.activeElement;
		if (activeElement) {
			activeElement.blur();
		}
		// London does not have it
		/*$timeout(function() {
			if (g_form) {
				g_form.submit(action.action_name || action.sys_id);
			}
		});
		*/
		//-----------------------------
		$scope.$evalAsync(function() {
			
      if (g_form) {
        $scope.submitting = true;
        if (!g_form.submit(action.action_name || action.sys_id)) {
          $scope.submitting = false;
					
					$rootScope.$broadcast('sp.form.submit.failed', action);
					}
				}

			});
		}

	$scope.$on("spModel.uiActionComplete", function(evt, response) {
    $scope.submitting = false;
    var sysID = (response.isInsert) ? response.sys_id : $scope.data.sys_id;




    var error;
    if (!response.$$uiNotification[0]) {
        error = false;
    } else {
        error = true;
    }
    if (!response.isInsert) {
        loadForm($scope.data.table, sysID).then(constructResponseHandler(response)); //+ 
    }

    //REDIRECTION (KTorres)
    if (response.isInsert && (!error) && ($scope.data.query == undefined || $scope.data.query.length == 0)) { // 
        //loadForm($scope.data.table, sys'ID).then(constructResponseHandler(response)); //+
        var redirectUrlNew;
        switch ($scope.data.table) {
            case 'x_153465_discovert_route_task_instance':
                redirectUrlNew = "../discovertaskerportal?id=discovertasker_taskdetails&table=" + $scope.data.table + "&sys_id=" + sysID; // +"&spa=1";
                $window.location = redirectUrlNew;
                ////$location.url(redirectUrlNew);
                break;
        }
    }

    if (response.isInsert && $scope.data.query.length > 0) {
        var parentSysID;
        var redirectUrl;
        //TODO: ADD LOGIC FOR REDIRECTION. KTORRES. IN PROGRESS 19-MAR-18
        //parentSysID = $scope.data.query.replace("parent=", "");
        //var redirectUrl = "../discovertaskerportal?id=discovertasker_taskdetails&table=" + $scope.data.table + "&sys_id="+ parentSysID +"&spa=1";

        switch ($scope.data.table) {
            case 'x_153465_discovert_route_tasks':
                parentSysID = $scope.data.query.replace("parent=", "");
                redirectUrl = "../discovertaskerportal?id=discovertasker_processtemplatedetails&table=" + $scope.data.table + "&sys_id=" + sysID + "&spa=1";
                $location.url(redirectUrl);
                break;
            case 'x_153465_discovert_tasker_schedule':
                //parentSysID = $scope.data.query.replace("tasker_process=", ""); 
                redirectUrl = "../discovertaskerportal?id=discovertasker_processtemplatelist&activeTab=0";
                //Ayman-STRY0014517 close modal after creating new schedule
                //$location.url(redirectUrl);
                break;
            case 'x_153465_discovert_route_task_instance':
                parentSysID = $scope.data.query.replace("parent=", "");
                redirectUrl = "../discovertaskerportal?id=discovertasker_taskdetails&table=" + $scope.data.table + "&sys_id=" + sysID + "&spa=1";
                $location.url(redirectUrl);
                break;
            case 'x_153465_discovert_discover_notification_instance':
                parentSysID = $scope.data.query.replace("discover_task_instance=", "");
                redirectUrl = "../discovertaskerportal?id=discovertasker_taskdetails&table=" + "x_153465_discovert_route_task_instance" + "&sys_id=" + parentSysID + "&spa=1";
                $location.url(redirectUrl);
                break;
            case 'x_153465_discovert_discover_office_members':
                parentSysID = $scope.data.query.replace("discover_office_hierarchy=", "");
                redirectUrl = "../discovertaskerportal?id=discovertasker_officehierarchy&table=" + "x_153465_discovert_discover_office_hierarchy" + "&sys_id=" + parentSysID + "&spa=1";
                $location.url(redirectUrl);
                break;
            case 'x_153465_discovert_discover_office_hierarchy':
                parentSysID = $scope.data.query.replace("parent=", "");
                redirectUrl = "../discovertaskerportal?id=discovertasker_officehierarchy&table=" + "x_153465_discovert_discover_office_hierarchy" + "&sys_id=" + parentSysID + "&spa=1";
                $location.url(redirectUrl);
                break;
            case 'x_153465_discovert_discover_routing_template':
                //parentSysID = $scope.data.query.replace("parent_task_def=", ""); 
                //redirectUrl = "../discovertaskerportal?id=discovertasker_processtemplatedetails&table=" + "x_153465_discovert_route_tasks" + "&sys_id="+ parentSysID +"&spa=1";
                //$location.url(redirectUrl);
                break;

            case 'x_153465_discovert_suggested_taskers':
                //parentSysID = $scope.data.query.replace("parent=", ""); 
                break;


            default:
                loadForm($scope.data.table, sysID).then(constructResponseHandler(response));
        }
    }

	});

	function constructResponseHandler(response) {
			var showUpdate = true;
			var notifications = response['$$uiNotification'];
			if (notifications && notifications[0].type == 'error') {
					showUpdate = false;
			}

			return function() {
					$rootScope.$broadcast("sp.form.submitted", {
							sys_id: (response.isInsert) ? response.sys_id : $scope.data.sys_id
					});
					var message;
					var eventName = "sp.form.record.updated";
					if (response.isInsert) {
							message = $scope.data.recordAddedMsg;
							var search = $location.search();
							search.sys_id = response.sys_id;
							search.spa = 1;
							$location.search(search).replace();
					} else if (showUpdate == true) {
							message = $scope.data.updatedMsg;
					}
					$scope.data.hideRelatedLists = hideRelatedLists();
					$scope.$emit(eventName, $scope.data.f._fields);
					$rootScope.$broadcast(eventName, $scope.data.f._fields);
					$scope.status = message;
					spUtil.addTrivialMessage(message);
					$timeout(clearStatus, 2000);
			}
	}

	var ctrl = this;
	// switch forms
	var unregister = $scope.$on('$sp.list.click', onListClick);
	$scope.$on("$destroy", function() {
			unregister();
	})

	function _save() {
			var primaryAction = $scope.getPrimaryAction();
			if (primaryAction)
					$scope.triggerUIAction(primaryAction);
	}

	function onListClick(evt, arg) {
			loadForm(arg.table, arg.sys_id)
	}

	function loadForm(table, sys_id) {
			var f = {};
			$scope.data.table = f.table = table;
			$scope.data.sys_id = f.sys_id = sys_id;
			f.view = $scope.data.view;
			return $scope.server.update().then(setupAttachmentHandler);
	}

	function openRelatedList(e, queryString) {
			// todo: Open this in a modal
			$location.search(queryString);
			e.preventDefault();
	}

	$scope.$on('spModel.fields.rendered', function() {
			if (ctrl.panels)
					ctrl.panels.removeClass('shift-out').addClass('shift-in');
	});

	var g_form;

	function initForm(gFormInstance) {

			if (gFormInstance.getTableName() == $scope.data.f.table) {


					g_form = gFormInstance;
					spNavStateManager.register($scope.data.table, _save, g_form);
					$scope.isPageReady = true;
					$timeout(function() {
							$rootScope.$emit('spModel.gForm.rendered', g_form);
					}, 175);
			}
	}

	$scope.$on('spModel.gForm.initialized', function(e, gFormInstance) {
			initForm(gFormInstance);
	});

	$scope.$on('spModel.gForm.env.created', function(e, gFormInstance) {
			initForm(gFormInstance);
	});

	// update the comments or worknotes based on activity stream
	$scope.$on("activity_stream_is_changed", function(event, data) {
			if (g_form && g_form.hasField(data.fieldName)) {
					g_form.setValue(data.fieldName, data.input);
					if (data.fieldToClear != "" && g_form.hasField(data.fieldToClear))
							g_form.setValue(data.fieldToClear, "");
			}
	})

	// Show or hide related lists
	$scope.$watch('data.f._related_lists', function() {
			$scope.data.hideRelatedLists = hideRelatedLists();

	}, true);

	function hideRelatedLists() {
			if (!$scope.data.f._related_lists)
					return true;

			if ($scope.options.hideRelatedLists == true)
					return true;

			if ($scope.data.sys_id == '-1')
					return true;

			// If all related lists are visible=false then hide
			if ($scope.data.f._related_lists.length > 0) {
					for (var i in $scope.data.f._related_lists) {
							var list = $scope.data.f._related_lists[i];
							if (list.visible) {
									return false;
							}
					}
			}
			return true;
	}

	function clearStatus() {
			$scope.status = "";
	}

	function setupAttachmentHandler() {
			$scope.attachmentHandler = new nowAttachmentHandler(appendDone, appendError);

			$scope.$evalAsync(function() {
					$scope.attachmentHandler.setParams($scope.data.table, $scope.data.f._attachmentGUID, 1024 * 1024 * $scope.data.maxAttachmentSize);
			});

			$scope.$on('dialog.upload_too_large.show', function(e) {
					$log.error($scope.data.largeAttachmentMsg);
					spUtil.addErrorMessage($scope.data.largeAttachmentMsg);
			});
	}
	setupAttachmentHandler();

	function appendDone() {
			// don't know here whether upload succeeded, so can't show msg either way
			$scope.$broadcast("sp.attachments.update", $scope.data.f._attachmentGUID);
			spAriaUtil.sendLiveMessage($scope.data.attachmentSuccessMsg);
	}

	function appendError(error) {
			$scope.errorMessages.push(error);
			spUtil.addErrorMessage(error.msg + error.fileName);
	}

	if ($scope.data.f.title) {
			$scope.$emit('sp.widget-modal.set-aria-label', $scope.data.f.title);
	}
	}]]></client_script>
        <controller_as>c</controller_as>
        <css>//------------------------------------------------------------------------------------------------------------------------
//--------------- Discover Techologies ---------------
//--------------- Modified by: Karina Torres ---------
//------------------------------------------------------------------------------------------------------------------------
.picker-open { position:fixed !important; }  
.disabled{display:none}
.fa-gears:before, .fa-cogs:before {
    display: inline-block;
    font: normal normal normal 14px/1 FontAwesome;
    font-size: inherit;
    text-rendering: auto;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

.placeholder-right-pane p {
    color: #81878E;
    font-size: 18px;
    font-weight: 300;
}

.placeholder-right-pane i {
    font-size: 200px;
    color: #E6E8EA;
}


.field-has-reference button{
  padding-bottom: 6px!important;
}

.vfb43a51ddb859b003a8d6be3ca9619e7 .btn-form-menu {
	border-color: #3A3F51!important
}
/*
.glyphicon-menu-hamburger:before {
	content: "MENU"!important;
  color: red;
  border-radius: 5px;
}
*/

#dur-minutes,
#dur-seconds { 
  visibility: hidden!important;
}

#dur-days,
#dur-hours { 
  width: 40px!important
  //width: auto!important;
}


#sp_formfield_status[title^='Critical']::before{
	//color: red!important;
  background-color: red!important;
}

.banners{
  //display: flex;
   margin-bottom: 15px;
}

//Green
.classification-banner-Unclassified{
  background-color: #2DCC70 !important;
	color: white !important;
  padding: 5px 10px 5px 10px; //before padding: 5px;
  border-radius: 5px;
  margin-bottom: 15px;
  margin-right: 5px; //new
	display: table-cell; border-radius: 8px; border: 3px solid white; //new
}

//Blue
.classification-banner-Official{
  background-color: #297FB8 !important;
	color: white !important;
  padding: 5px 10px 5px 10px; //before padding: 5px;
  border-radius: 5px;
  margin-bottom: 15px;
 	margin-right: 5px; //new
	display: table-cell; border-radius: 8px; border: 3px solid white; //new
}

//Green
.classification-banner-Protected{
  background-color: #2DCC70 !important;
	color: white !important;
  padding: 5px 10px 5px 10px; //before padding: 5px;
  border-radius: 5px;
  margin-bottom: 15px; 
  margin-right: 5px;
	display: table-cell; border-radius: 8px; border: 3px solid white;
}

//Green
.classification-banner-Restricted{
  background-color: #1ABC9C !important;
	color: white !important;
  padding: 5px 10px 5px 10px; //before padding: 5px;
  border-radius: 5px;
  margin-bottom: 15px;
  margin-right: 5px;
	display: table-cell; border-radius: 8px; border: 3px solid white;
}

//Red
.classification-banner-Secret{
  background-color: #E84C3D !important;
	color: white !important;
  padding: 5px 10px 5px 10px; //before padding: 5px;
  border-radius: 5px;
  margin-bottom: 15px;
  margin-right: 5px; //new
	display: table-cell; border-radius: 8px; border: 3px solid white; //new
}

//Yellow
.classification-banner-Top.Secret{
  background-color: #FFCC00 !important;
	color: white !important;
  padding: 5px 10px 5px 10px; //before padding: 5px;
  border-radius: 5px;
  margin-bottom: 15px;
  margin-right: 5px; //new
	display: table-cell; border-radius: 8px; border: 3px solid white; //new
}


//Assignment Group
.assignmentgroup-banner{
  background-color: #FF6B61 !important; //#4C9AAE
	color: white !important;
  padding: 5px 10px 5px 10px;
  border-radius: 5px;
  margin-bottom: 15px;
  margin-right: 15px;
  display: table-cell; border-radius: 8px; border: 3px solid white; 
}

.ng-isolate-scope .h4.ng-binding{
  font-weight: 400 !important;
  font-family: "SourceSansPro", Helvetica, Arial, sans-serif; //'Lucida Sans Unicode';
  padding-left: 5px;
	border-left-style: solid;
	border-left-color: #2E3C54;
	border-left-width: 5px;
	color: #2E3C54;
	padding-top: 8px;
	padding-bottom: 5px;
}

fieldset.ng-scope{
  margin-top: 5px;
}

label{
   font-weight: 300!important;
   color: #004475!important;
}

div.timeline-title.h4.ng-binding{
   font-size: 1em !important;
}

.th-title {
   color: #004475!important; //color: #428bca!important;
}

.icon-success {
    color: #37C1C3;
}

.icon-danger {
    color: #FF6B61;
}

.icon-warning {
    color: #F6C716;
}

.icon-primary {
    color: #2E3C54;
}


.icon-default {
    color: #808080;
}
//------------------------------------------------------------------------------------------------------------------------

.btn-form-menu {
	vertical-align: inherit;
  padding: inherit;
  background: none;
}

.panel-title {
  word-wrap: break-word;
  //font-size: 1.25em !important;
}

.comment {
	font-weight: bold;
	margin-top: 2px;
	margin-bottom: 2px;
}
.mce-panel, .mce-btn {
	background-image: none;
	background-color: #f0f3f4;
}

.action-btn {
  margin-right: 2px;
	margin-top: 5px;
}

.timeline-container {
   max-height: 50vh;
   height: 100%;
   overflow-y: auto;
}

.panel .panel {
    height: auto !important;
}

.attachment-button {
  .glyphicon-paperclip {
    font-size: 18px;
  }
}

.empty-state-wrapper {
  width: 100%;
  height: 100%;
  align-items: center;
  display: flex;
  flex-direction: column;
  padding: 10vh 20px 20px;

  .empty-state {
    border: 1px solid #e7e9eb;
    border-radius: 10px;
    max-width: 700px;
    padding: 30px 40px 20px;
    position: relative;

    .empty-state-badge {
      top: -36px;
      left: 50%;
      position: absolute;
      height: 72px;
      width: 72px;
      -webkit-align-items: center;
      -ms-flex-align: center;
      align-items: center;
      border-radius: 100%;
      color: #ffffff;
      display: -webkit-flex;
      display: -ms-flexbox;
      display: flex;
      font-size: 40px;
      -webkit-justify-content: center;
      -ms-flex-pack: center;
      justify-content: center;
      margin-left: -36px;
      text-align: center;
    }

    .empty-state-header {
      font-size: 30px;
      text-align: center;
      color: #343d47;
    }

    .empty-state-content {
      ul {
        list-style: disc outside;
        margin: 0 0 10px 0;
        padding: 0 0 0 30px;
      }
    }
  }
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>discovertasker-formtab</id>
        <internal>false</internal>
        <link/>
        <name>Tasker Form with Tabs</name>
        <option_schema>[{"name":"disableUIActions","label":"Disable UI Actions on Form","type":"boolean"},{"name":"showFormView","label":"Display current form view","type":"boolean"},{"name":"omitHeaderOptions","label":"Omit header options icon","type":"boolean"}]</option_schema>
        <public>false</public>
        <roles>x_153465_discovert.tasker_user</roles>
        <script><![CDATA[// form functionality - URL parameter driven
(function($sp, input, data, options, gs) {
  /* "use strict"; -linter issues */
  // populate the 'data' variable
	data.attachmentUploadSuccessMsg = gs.getMessage("Attachment upload was successful");
	data.recordAddedMsg = gs.getMessage("Record Added");
	data.updatedMsg = gs.getMessage("updated_uppercase");
	data.exportPDFMsg = gs.getMessage("Export to PDF");
	data.exportPDFLandMsg = gs.getMessage("Export to PDF (landscape)");
	data.addAttachmentMsg = gs.getMessage("Add an attachment");
	data.maxAttachmentSize = parseInt(gs.getProperty("com.glide.attachment.max_size", 1024));
	if (isNaN(data.maxAttachmentSize))
		data.maxAttachmentSize = 24;
	data.largeAttachmentMsg = gs.getMessage("Attached files must be smaller than {0} - please try again", "" + data.maxAttachmentSize + "MB");
	data.attachmentSuccessMsg = gs.getMessage("Attachment successfully uploaded");
		
	data.isAdmin = gs.hasRole('x_153465_discovert.tasker_user'); //data.isAdmin = gs.hasRightsTo('sp/configure.all/execute', null); //for GLOBAL app
	data.emptyStateTemplate = options.empty_state_template;
	data.disableUIActions = options.disableUIActions === "true";
	data.hideRelatedLists = options.hideRelatedLists || false;
	
	//------------------------------------------------------------------------------------------------------------------------
	// CUSTOM
	//------------------------------------------------------------------------------------------------------------------------
	data.page_id = $sp.getParameter("id");
	data.sys_id = $sp.getParameter("sys_id");
	data.view = $sp.getParameter("view"); 
	data.filter = $sp.getParameter("filter") || $sp.getValue('filter');
	data.isValid = true;
	data.current_user = gs.getUserID();
	if(!options.showFormView) {
		options.showFormView = "false";
	}
	//------------------------------------------------------------------------------------------------------------------------

	if (input) {	
		var myUserObject = gs.getUser(); 
		var currentUser = myUserObject.getDisplayName();	
		data.table = input.table;
		data.sys_id = input.sys_id;
		data.view = input.view;
		var result = {};
		if (input._fields) {
			result = $sp.saveRecord(input.table, input.sys_id, input._fields);
			data.sys_id = result.sys_id;
		}
		
		if (input.sys_id == '-1') 
			data.isNewRecord = true;
	} else {
		data.table = options.table || $sp.getParameter("t") || $sp.getParameter("table") || $sp.getParameter("sl_table");
		data.sys_id = options.sys_id || $sp.getParameter("sys_id") || $sp.getParameter("sl_sys_id");
		data.view = options.view || $sp.getParameter("v") || $sp.getParameter("view"); // no default
	}
	
	if (input) {
		data.query = $sp.getParameter("query") || options.query || input.query;
	} else {
		data.query = $sp.getParameter("query") || options.query || "";
	}
	data.f = {};
	if (!data.table)
		return;	
	
	// Form widget is not a supported way to view an attachment
	if (data.table == "sys_attachment") {
		data.tableUnsupported = true;
		return;
	}
	
	if(gs.tableExists(data.table) == false) //if (!GlideTableDescriptor.isValid(data.table)) //for GLOBAL app
		return;

	if (!data.sys_id)
		return;
	
	//Possible Disabled for Restricted Tasks
	var rec = new GlideRecord(data.table);
	//var rec = new GlideRecordSecure(data.table); //var rec = $sp.getRecord(data.table, data.sys_id);  //for GLOBAL app
	rec.get(data.sys_id);
	 
	data.isValid = rec.isValid() || data.sys_id == "-1";
	if (!data.isValid)
		return;
	
	data.table = rec.getRecordClassName();
	//data.tableHierarchy = GlideDBObjectManager.getTables(data.table).toArray().join(); //for GLOBAL app
	var table = new GlideTableHierarchy(data.table); 
	data.tableHierarchy = table.getTables();
	data.canWrite = rec.canWrite();
	var hasRecordAccess = data.sys_id == "-1" ? rec.canCreate() : data.canWrite;
	
	//KTORRES: STRY0014160: If user doesn't have Read access, stop here.
	data.hasRecordReadAccess = true;
	if (data.table == "x_153465_discovert_route_task_instance"){
		data.hasRecordReadAccess = rec.canRead();
		if (!data.hasRecordReadAccess) {
			var link = '<a href="../discovertaskerportal">Tasker Portal</a>';
			var message = 'You do not have permission to view this Task. ' + link + ' .<br/>';	
			gs.addInfoMessage(message);
			return;
		}
	}
	
	//data.canAttach = data.canWrite && gs.hasRole(gs.getProperty('glide.attachment.role')) && !GlideTableDescriptor.get(data.table).getED().getBooleanAttribute("no_attachment"); //for GLOBAL app
	//var gtd = new GlideTableDescriptor(data.table);
	//&& !gtd.get(data.table).getED().getBooleanAttribute("no_attachment"); 
	data.canAttach = data.canWrite && gs.hasRole(gs.getProperty('glide.attachment.role')) 
	data.f = $sp.getForm(data.table, data.sys_id, data.query, data.view);  
	
	/* //OOTB
	data.table = rec.getRecordClassName();
	data.tableHierarchy = GlideDBObjectManager.getTables(data.table).toArray().join();
	data.canWrite = rec.canWrite();
	var hasRecordAccess = data.sys_id == "-1" ? rec.canCreate() : data.canWrite;
	data.canAttach = hasRecordAccess && gs.hasRole(gs.getProperty('glide.attachment.role')) && !GlideTableDescriptor.get(data.table).getED().getBooleanAttribute("no_attachment");
	data.f = $sp.getForm(data.table, data.sys_id, data.query, data.view);
	*/
	

	//------------------------------------------------------------------------------------------------------------------------
	// BEGING CUSTON
	//------------------------------------------------------------------------------------------------------------------------

	//------------------------------------------------------------------------------------------------------------------------
	// 1. CUSTOM: CLASSIFICATION BAR
	//------------------------------------------------------------------------------------------------------------------------
		if (data.table == "x_153465_discovert_war_sar_reporting" &&	data.sys_id != -1)
			data.f.classification = data.f._fields['classification']["displayValue"];
		
		if (data.table == "x_153465_discovert_route_task_instance" &&	data.sys_id != -1){
			data.number = data.f._fields['number']["displayValue"];
			data.task_name = data.number + ": " + data.f._fields['short_description']["displayValue"];
			data.f.classification = data.f._fields['classification']["displayValue"];
			data.f.assignment_group = data.f._fields['assignment_group']["displayValue"];
			data.f.task_instance__state = '';//data.f._fields['state']["displayValue"];
			setBreadcrumbs(data.page_id, data.task_name);			
	}	
	
	if (data.table == "x_153465_discovert_discover_routing_template" & data.sys_id != -1){
			data.f.template_name = data.f._fields['template_name']["displayValue"];
	}

	//------------------------------------------------------------------------------------------------------------------------
	// 2. CUSTOM: TABS
	//------------------------------------------------------------------------------------------------------------------------
	for (var i in data.f._related_lists) {
		var rl = data.f._related_lists[i];

		var open_row_details_in_modal = false;
		
		
		if (data.page_id == "discovertasker_detailsdrilldown" && data.table == "x_153465_discovert_route_task_instance") open_row_details_in_modal = true;
		if (data.page_id == "discovertasker_officehierarchy" && data.table == "x_153465_discovert_discover_office_hierarchy" && rl.table == "x_153465_discovert_route_task_instance") open_row_details_in_modal = true; 
		if (data.table == "x_153465_discovert_discover_routing_template") open_row_details_in_modal = true;
		if (rl.table == "x_153465_discovert_discover_office_members") open_row_details_in_modal = true;
		if (rl.table == "x_153465_discovert_tasker_attachment_properties") open_row_details_in_modal = true;
		if (data.page_id == "discovertasker_customtasker_details" && data.table == "x_153465_discovert_war_sar_reporting") open_row_details_in_modal = true;
		

		if (rl.table != "sys_attachment") {
				var params = {
					table: rl.table, 
					filter: rl.field+"="+data.sys_id,
					view: 'sp',
					title: getTabTitle(rl.table, rl.label),//rl.label,
					open_row_details_in_modal: open_row_details_in_modal
					//show_breadcrumbs: true
				};
		
				/*i:0 sys_attachment*/
			  if (options.page) {
					var page = new GlideRecordSecure('sp_page');
					if (page.get(options.page))
						data.page = page.getDisplayValue('id');
				}
				if (!data.page) {
					data.page = "form";	
				}
			
				rl.widget = $sp.getWidget('discovertasker-widget-data-table', params);
		}
  }

	//------------------------------------------------------------------------------------------------------------------------
	// 3. CUSTOM: N TAB: PROGRESS BAR & AUDIT WIDGET 
	//------------------------------------------------------------------------------------------------------------------------
	data.widgetInstanceMultipleBar = $sp.getWidget('discovertasker-statesmultiplebar',
																	{table: data.table,
																	 sys_id: data.sys_id});
		
	data.widgetInstanceAuditNotes = $sp.getWidget('widget-ticket-conversation',
																	{table: data.table,
																	 sys_id: data.sys_id,
																	 includeExtended: true,
																	 title: "${Activity}",
																	 use_dynamic_placeholder: true,
																	 btnLabel: "${Post}"});
	
	//------------------------------------------------------------------------------------------------------------------------
	// 4. CUSTOM: GET TABTITLE
	//------------------------------------------------------------------------------------------------------------------------
	function getTabTitle(table_name, related_table_name){
		var tabTitle = '';
		
		switch(table_name) {
				case "x_153465_discovert_route_task_instance": tabTitle = 'Sub Tasks'; break;
				case "x_153465_discovert_route_tasks": tabTitle = 'Sub Tasks'; break;
				case "x_153465_discovert_discover_office_hierarchy": tabTitle = 'Sub OUs'; break;
				case "x_153465_discovert_discover_office_members": tabTitle = 'OU Members'; break;
				case "x_153465_discovert_discover_routing_template": tabTitle = 'Process Instances'; break;
				
				default: tabTitle = related_table_name;

		}
		return tabTitle;
	}
	
	//------------------------------------------------------------------------------------------------------------------------
	// 5. CUSTOM: SET BREADCRUMNS
	//------------------------------------------------------------------------------------------------------------------------
	function setBreadcrumbs(page_id, task_name){
		var title = "";//"Task Details: ";
		if (page_id == "discovertasker_taskdetails") {
			data.breadcrumbs = 
					 [{label: title + task_name, url: "#"} //parent
					  ]; //this
		}
		
		if (page_id == "discovertasker_relatedtasks") {
			data.breadcrumbs = 
					 [{label: title + task_name, url: "?id=discovertasker_taskdetails&table=" + data.table + "&sys_id=" + data.sys_id}, //parent
					  {label: "Related Tasks", url: '#'}]; //this
		}
	}
//----------------------------------test prompt for instance notation
	

		if(input){
			if(input.processInstanceName != undefined){
				data.processInstanceName = input.processInstanceName;
				
				data.test = new RunProcessTemplate().runProcessTemplate(data.sys_id, data.processInstanceName);
				gs.addInfoMessage("tests")
			}
		
		
	}
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	///==================
	
	//------------------------------------------------------------------------------------------------------------------------
	// END CUSTON
	//------------------------------------------------------------------------------------------------------------------------
	
	// Activity formatter is hardcoded to set specific options
	for (var f in data.f._formatters) {
		var fm = data.f._formatters[f];
		if (fm.formatter == "activity.xml") {
			fm.hardcoded = true;
			fm.widgetInstance = $sp.getWidget('widget-ticket-conversation',
																{table: data.table,
																 sys_id: data.sys_id,
																 includeExtended: true,
																 title:'Audit/Notes', //"${Activity}",
																 use_dynamic_placeholder: true,
																 btnLabel: "${Post}"});
		} else if(fm.formatter == "com_glideapp_servicecatalog_veditor" || fm.formatter == "com_glideapp_questionset_default_question_editor") {
			var qsConfig = $sp.getValue('quick_start_config');
			if (qsConfig)
				qsConfig = JSON.parse(qsConfig)[0];
			fm.widgetInstance = $sp.getWidget(fm.widget, {table: data.table,
														sys_id: data.sys_id,
														readonly_variable_editor: qsConfig ? qsConfig.readonly_variable_editor : 'false'});
		} else
			fm.widgetInstance = $sp.getWidget(fm.widget, data);
	}
	
})($sp, input, data, options, gs);





//-----------------------end of create suggested task
//------------------------------------------------------------------------------------------------------------------------
// COMPANY: DISCOVER TECHNOLOGIES
// CUSTOMIZED BY: KARINA TORRES
// WIDGET BASE: FORM
//------------------------------------------------------------------------------------------------------------------------]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>KTorres</sys_created_by>
        <sys_created_on>2018-03-23 19:54:05</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>fb43a51ddb859b003a8d6be3ca9619e7</sys_id>
        <sys_mod_count>2174</sys_mod_count>
        <sys_name>Tasker Form with Tabs</sys_name>
        <sys_package display_value="Tasker" source="x_153465_discovert">c6b1162d4fc10300303dc3818110c7b1</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Tasker">c6b1162d4fc10300303dc3818110c7b1</sys_scope>
        <sys_update_name>sp_widget_fb43a51ddb859b003a8d6be3ca9619e7</sys_update_name>
        <sys_updated_by>aalzyoud</sys_updated_by>
        <sys_updated_on>2019-04-11 09:29:29</sys_updated_on>
        <template><![CDATA[<div ng-if="!data.isValid && !data.emptyStateTemplate" class="panel panel-default">
  <div class="panel-body wrapper-lg text-center">
    
		<span ng-if="!data.tableUnsupported">${Record not found or record not selected}</span> 
    <!--<span ng-if="!data.tableUnsupported">Please make a selection</span>-->
		<span ng-if="data.tableUnsupported">${Form view not supported for requested table}</span>
    
  </div>
</div>

<div ng-if="!data.isValid && data.emptyStateTemplate" class="panel-shift">
  <div class="empty-state-wrapper panel panel-default" ng-include="data.emptyStateTemplate"></div>
</div>

<div ng-if="data.isValid" class="panel-shift">
  <div class="" ng-if="!data.f._view.length && data.hideRelatedLists && data.emptyStateTemplate">
    <div class="empty-state-wrapper panel panel-default" ng-include="data.emptyStateTemplate"></div>
  </div>

  <div class="" ng-if="!data.f._view.length && data.hideRelatedLists && !data.emptyStateTemplate">
    <div class="panel panel-default">
      <div class="panel-heading">
        <span ng-if="data.page_id != 'discovertasker_officehierarchy' && data.sys_id.length > 2" class="panel-title">{{data.f.title}}<span ng-if="options.showFormView == 'true' && data.f.view != ''">[{{data.f.view_title}} view] </span></span>
        <span ng-if="data.page_id == 'discovertasker_officehierarchy' && !data.sys_id" class="panel-title">Organizational Unit</span>
      </div>
      <div class="panel-body wrapper-lg text-center">
         <div ng-if="!data.sys_id && data.page_id == 'discovertasker_officehierarchy'" class="col-md-12 text-center placeholder-right-pane ng-scope">
					<i class="fa fa-gears" aria-hidden="true"></i> 
					<p class="m-t-lg">Select an item from the left</p>
         </div>
         <div ng-if="data.hasRecordReadAccess == false"><br>You do not have permission to view this Task<br></div> 
         <div ng-if="data.sys_id && data.page_id != 'discovertasker_officehierarchy'">
              ${No elements to display}
         </div>
        
      </div>
    </div>
  </div>
  
  <div class="panel panel-{{::options.color}}" ng-if="data.f._view.length || !data.hideRelatedLists" >
    <div class="panel-heading" ng-if="data.f.title.length" sp-context-menu="getUIActionContextMenu(event)">
      <div class="banners">
        <div class="classification-banner-{{data.f.classification}}" ng-show="data.f.classification.length > 0"> 
          <span class="glyphicon glyphicon-tag" title="Classification"></span>&nbsp;&nbsp;<span title="Classification">{{data.f.classification}}</span>
        </div>
        <div class="assignmentgroup-banner" ng-show="data.f.assignment_group.length > 0"> 
          <span class="glyphicon glyphicon-lock" title="Assignment Group"></span>&nbsp;&nbsp;<span title="Assignment Group">{{data.f.assignment_group}}</span>
        </div>
      </div>
    
      <span class="dropdown m-r-xs" ng-if="(data.isAdmin || getUIActions('context').length > 0) && options.omitHeaderOptions != 'true'">
            <button aria-label="${Form menu}" class="btn btn-form-menu dropdown-toggle glyphicon glyphicon-menu-hamburger" style="line-height: 1.4em" id="adminMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
            <ul class="dropdown-menu" aria-labelledby="adminMenu">
              <li ng-if="::data.isAdmin"><a href="/{{data.f.table}}.do?sys_id={{data.f.sys_id}}" target="_blank">${Open in platform}</a></li>
              <li ng-if="::data.isAdmin" class="dropdown-header">${Configure}</li>
              <li ng-if="::data.isAdmin"><a href="/slushbucket.do?sysparm_referring_url={{adminMenu.encodedPageUrl}}&sysparm_list={{data.f._sections[0].id}}&sysparm_form=section&sysparm_view={{data.f.view}}" target="_blank">${Form Layout}</a></li>
              <li ng-if="::data.isAdmin"><a href="/slushbucket.do?sysparm_referring_url={{adminMenu.encodedPageUrl}}&sysparm_list={{data.f.table}}&sysparm_form=related_list&sysparm_view={{data.f.view}}" target="_blank">${Related Lists}</a></li>
              <li ng-if="::data.isAdmin"><a href="?id=lf&table=sys_ui_policy&filter=table%3D{{data.f.table}}%5EORtableIN{{data.tableHierarchy}}%5Eactive%3Dtrue%5Eui_type%3D1%5EORui_type%3D10" ng-click="openRelatedList($event, {id:'lf', table: 'sys_ui_policy', filter: 'table%3D{{data.f.table}}%5EORtableIN{{data.f.table}},sys_metadata%5Eactive%3Dtrue%5Eui_type%3D1%5EORui_type%3D10'})">${UI Policies} <span class="badge pull-right" ng-if="f.policy.length">{{f.policy.length}}</span></a></li>
              <li ng-if="::data.isAdmin"><a href="?id=lf&table=sys_script_client&filter=table%3D{{data.f.table}}%5EORtableIN{{data.tableHierarchy}}%5Eactive%3Dtrue%5Eui_type%3D1%5EORui_type%3D10" ng-click="openRelatedList($event, {id: 'lf', table: 'sys_script_client', filter: 'table%3D{{data.f.table}}%5EORtableIN{{data.f.table}},sys_metadata%5Eactive%3Dtrue%5Eui_type%3D1%5EORui_type%3D10'})">${Client Scripts} <span class="badge pull-right" ng-if="adminMenu.getClientScriptCount()">{{adminMenu.getClientScriptCount()}}</span></a></li>
              <li ng-if="getUIActions('context').length > 0 &&  data.isAdmin" role="separator" class="divider"></li>
              <li ng-repeat="action in getUIActions('context')"><a href="" ng-click="triggerUIAction(action)">{{action.name}}</a></li>
              <li ng-if="::data.isAdmin || getUIActions('context').length > 0" role="separator" class="divider"></li>
              <li><a target="_new" href="/{{data.f.table}}.do?PDF&sys_id={{data.sys_id}}&sysparm_view={{data.f.view}}">${Export to PDF}</a></li>
              <li><a target="_new" href="/{{data.f.table}}.do?PDF&landscape=true&sys_id={{data.sys_id}}&sysparm_view={{data.f.view}}">${Export to PDF (landscape)}</a></li>
            </ul>
        </span>
      
      <span class="panel-title" aria-label="{{data.f.title}}"><!--span class="glyphicon glyphicon-flag icon-warning" aria-hidden="true"></span-->
        <span ng-if="(data.number.length > 0)"> &nbsp;{{data.number}}: </span>
        {{data.f.title}}
      </span>  
      <span ng-if="options.showFormView == 'true' && data.f.view != ''">[{{data.f.view_title}} view]</span>
      
      <div ng-if="attachmentHandler && data.canAttach" title="{{::data.addAttachmentMsg}}" class="pull-right attachment-button">
      	<sp-attachment-button></sp-attachment-button>
      </div>
      <!-- BEGIN CUSTOM -->
      <!-- Header Icons -->
      <div ng-switch="data.table" class="pull-right">
        <div ng-switch-when="x_153465_discovert_route_task_instance" class="pull-right"> 
          	<div ng-switch="data.page_id" class="pull-right">
            		<a ng-switch-when="discovertasker_detailsdrilldown" ng-href="?id=discovertasker_taskdetails&&table={{data.table}}&sys_id={{data.sys_id}}&p={{data.p}}&filter={{data.filter}}" class="glyphicon glyphicon glyphicon-resize-full" title="Full-screen" role="link"></a>
        				<a ng-switch-when="discovertasker_taskdetails" ng-href="?id=discovertasker_detailsdrilldown&&table={{data.table}}&sys_id={{data.sys_id}}&p={{data.p}}&filter={{data.filter}}&view=ess" class="glyphicon glyphicon glyphicon-resize-small" title="Exit Full-screen" role="link"></a>
      			</div>
        </div>
        
        <div ng-switch-when="x_153465_discovert_discover_routing_runtime" class="pull-right">
          	<div ng-switch="data.page_id" class="pull-right">
            		<a ng-switch-when="discovertasker_detailsdrilldown" ng-href="?id=discovertasker_processroutetaskdetails&&table={{data.table}}&sys_id={{data.sys_id}}&p={{data.p}}&filter={{data.filter}}" class="glyphicon glyphicon glyphicon-resize-full" title="Full-screen" role="link"></a>
        				<a ng-switch-when="discovertasker_processroutetaskdetails" ng-href="?id=discovertasker_detailsdrilldown&&table={{data.table}}&filter={{data.filter}}&view=ess" class="glyphicon glyphicon glyphicon-resize-full" title="Exit Full-screen" role="link"></a>
      			</div>
        </div>
        <!-- Custom Tasker: WAR/SAR -->
        <div ng-switch-when="x_153465_discovert_war_sar_reporting" class="pull-right">
          	<div ng-switch="data.page_id" class="pull-right">
            		<a ng-switch-when="discovertasker_detailsdrilldown" ng-href="?id=discovertasker_customtasker_details&&table={{data.table}}&sys_id={{data.sys_id}}&p={{data.p}}&filter={{data.filter}}" class="glyphicon glyphicon glyphicon-resize-full" title="Full-screen" role="link"></a>
        				<a ng-switch-when="discovertasker_customtasker_details" ng-href="?id=discovertasker_detailsdrilldown&&table={{data.table}}&filter={{data.filter}}&view=ess" class="glyphicon glyphicon glyphicon-resize-full" title="Exit Full-screen" role="link"></a>
      			</div>
        </div>
      </div>
      
      <div style="clear: both;"></div>
       
      <div>
        <div ng-if="data.page_id != 'discovertasker_detailsdrilldown'" style="padding-top: 15px;">
          <button ng-if="getPrimaryAction() && data.sys_id.length > 2" type="submit" ng-click="triggerUIAction(getPrimaryAction())" ng-disabled="submitting" class="btn btn-default action-btn" gsft_id="{{::getPrimaryAction().sys_id ? getPrimaryAction().sys_id : ''}}">Update<span ng-if="saveButtonSuffix"></span></button>
      		<button ng-click="triggerUIAction(action)" ng-disabled="submitting" ng-repeat="action in getUIActions('button')" class="btn btn-primary action-btn" gsft_id="{{::action.sys_id}}">{{action.name}}</button>
        	<span>{{status}}</span>
         <!-- <button ng-if="c.thisPage == 'discovertasker_processtemplatelist'" class="btn btn-success action-btn"  ng-click="openProcessPrompt()">Run Process Template  </button>-->
        </div>
        <div class="pull-right">
        	<!--button ng-if="getPrimaryAction()" type="submit" ng-click="triggerUIAction(getPrimaryAction())" class="btn btn-primary action-btn pull-right">${Save} <span ng-if="saveButtonSuffix">(${{{saveButtonSuffix}}})</span></button-->
        </div>
      </div>

      
    </div>
    <!-- END CUSTOM -->

    <div class="panel-body">
     
      <!-- attachments -->
			<div ng-if="data.table == 'x_153465_discovert_route_task_instance' && data.page_id != 'discovertasker_taskdetails'">
      	<sp-attachment-manager table="data.table" sys-id="data.f._attachmentGUID" omit-edit="!data.canAttach"></sp-attachment-manager>
      </div>
      
      <div ng-if="data.table != 'x_153465_discovert_route_task_instance'">
      	<sp-attachment-manager table="data.table" sys-id="data.f._attachmentGUID" omit-edit="!data.canAttach"></sp-attachment-manager>
      </div>

      
  <!-- KTorres related lists -->
  <!--div class="panel-body"-->
    <div ng-if="!data.hideRelatedLists">
        <div style="margin-bottom: 7px; padding-bottom: 7px; border-bottom: 1px solid #f5f5f5;">
         
          <ul class="nav nav-tabs" role="tablist">
            
            	<li class="active">
								<a ng-class='active' data-target="#Information" aria-controls="Information" role="tab" data-toggle="tab">Information</a> <!-- href="#Information"  -->
              </li>
            	<!--
							<li class="active">
								<a href="#Information" aria-expanded="true" role="tab" data-toggle="tab">Information</a>
              </li>
            	-->
            
              <li ng-switch="rl.table" ng-repeat="rl in data.f._related_lists" ng-if="rl.table != 'sys_attachment'">
                	<!-- Tasks Tabs -->
                	<a ng-if="data.table == 'x_153465_discovert_discover_routing_template'" ng-switch-when="x_153465_discovert_route_task_instance" data-target="#{{rl.table}}" aria-controls="{{rl.table}}" role="tab" data-toggle="tab">Process Instances <!-- href="#SubTasks"  -->
                    <span class="label label-as-badge label-primary" ng-if="rl.count">{{rl.count}}</span>
                  </a>
                	<a ng-if="data.table != 'x_153465_discovert_discover_routing_template'" ng-switch-when="x_153465_discovert_route_task_instance" data-target="#{{rl.table}}" aria-controls="{{rl.table}}" role="tab" data-toggle="tab">Sub Tasks <!-- href="#SubTasks"  -->
                    <span class="label label-as-badge label-primary" ng-if="rl.count">{{rl.count}}</span>
                  </a>
                	<a ng-if="data.table != 'x_153465_discovert_discover_routing_template'" ng-switch-when="x_153465_discovert_route_tasks" data-target="#{{rl.table}}" aria-controls="{{rl.table}}" role="tab" data-toggle="tab">Sub Tasks <!-- href="#SubTasks"  -->
                    <span class="label label-as-badge label-primary" ng-if="rl.count">{{rl.count}}</span>
                  </a>
                
                	<!-- Office Hierarchy Tabs -->
                	<a ng-switch-when="x_153465_discovert_discover_office_hierarchy" data-target="#{{rl.table}}" aria-controls="{{rl.table}}" role="tab" data-toggle="tab">Sub OUs <!-- href="#SubOUs"  -->
                    <span class="label label-as-badge label-primary" ng-if="rl.count">{{rl.count}}</span>
                  </a>
                	<a ng-switch-when="x_153465_discovert_discover_office_members" data-target="#{{rl.table}}" aria-controls="{{rl.table}}" role="tab" data-toggle="tab">OU Members <!-- href="#OUMembers"  -->
                    <span class="label label-as-badge label-primary" ng-if="rl.count">{{rl.count}}</span>
                  </a>
                           
                	<!-- Other Tabs -->
                  <a ng-switch-default data-target="#{{rl.table}}" aria-controls="{{rl.table}}" role="tab" data-toggle="tab" >{{rl.label}}
                    <span class="label label-as-badge label-primary" ng-if="rl.count">{{rl.count}}</span>
                  </a>
              </li>
            
              <li ng-if="data.table == 'x_153465_discovert_route_task_instance'">
								<!--
								<a href="#TicketAudit" aria-controls="x_153465_discovert_route_task_instance" role="tab" data-toggle="tab">Activity
                	<span class="label label-as-badge label-primary"></span>
								</a>
								-->
                <a data-target="#TicketAudit" aria-controls="TicketAudit" data-toggle="tab">Activity</a> <!-- href="#TicketAudit"  -->
            	</li>
            
          </ul>
          
        </div>
    </div>
  	<div class="tab-content">

     	<div class="tab-pane ng-scope active in" id="Information"> <!--instead: tab-pane fade in active -->
				<div>
          <sp-model form_model="data.f" mandatory="mandatory"></sp-model>
				</div>
      </div>
      
      <!--data.page_id
ng-if="rl.table == 'x_153465_discovert_route_task_instance'"
      id=discovertasker_officehierarchy&table=x_153465_discovert_discover_office_hierarchy
-->      
      
      <div class="tab-pane" id="{{rl.table}}" ng-repeat="rl in data.f._related_lists" ng-if="rl.table != 'sys_attachment'"> <!--  ng-class='{active:$first}' -->
        <div style="margin-top: -1px;">
          <div class="alert alert-danger" ng-if="data.invalid_table">
            Table not defined '{{data.table_label}}'
          </div>
          <div ng-if="!data.invalid_table">
            <div ng-if="rl.table == 'x_153465_discovert_route_task_instance'">
              <sp-widget widget="data.widgetInstanceMultipleBar"></sp-widget>
            </div>
          	<sp-widget widget="rl.widget"></sp-widget>
          </div>
          <div ng-switch="rl.table" class="pull-right" ng-if="!data.invalid_table">
            <div ng-switch-when="x_153465_discovert_discover_office_members" class="pull-right"> 
          		<a ng-href="?id=discovertasker_newtask&table={{rl.table}}&sys_id=-1&query=discover_office_hierarchy={{data.sys_id}}" class="btn btn-primary action-btn pull-right ng-scope" role="button">New</a>
            </div>
            <!--div ng-switch-when="x_153465_discovert_discover_notification_instance" class="pull-right"> 
          		<a ng-href="?id=discovertasker_newtask&table={{rl.table}}&sys_id=-1&query=discover_task_instance={{data.sys_id}}" class="btn btn-primary action-btn pull-right ng-scope" role="button">New</a>
            </div-->
            <div ng-switch-when="x_153465_discovert_route_tasks" class="pull-right"> 
            	<div ng-if="data.f.template_name" class="pull-right"> 
              	<a ng-href="?id=discovertasker_newtask&table={{rl.table}}&sys_id=-1&query=tasker_process_definition={{data.sys_id}}" class="btn btn-primary action-btn pull-right ng-scope" role="button">New</a>
              </div>
            	<div ng-if="(!data.f.template_name && data.table != x_153465_discovert_discover_routing_template && data.sys_id != -1) " class="pull-right"> 
              	<a ng-click="openNewModal('x_153465_discovert_route_tasks','New Process Template Task','Create_View','parent=',data.sys_id);"  class="btn btn-primary action-btn pull-right ng-scope" role="button" >New</a>
              </div>
            </div>
            <div ng-switch-when="x_153465_discovert_tasker_attachment_properties" class="pull-right"></div>
            <div ng-switch-when="x_153465_discovert_tasker_schedule" class="pull-right"> 
          		<a ng-click="openNewModal('x_153465_discovert_tasker_schedule','New Schedule','Create_View','tasker_process=' , data.sys_id);" class="btn btn-primary action-btn pull-right ng-scope" role="button">New</a>
            </div>
            <div ng-switch-default="x_153465_discovert_route_task_instance" class="pull-right"> 
          		<div ng-if="data.f.table == 'x_153465_discovert_discover_routing_template'"></div>
              <div ng-if="data.f.table != 'x_153465_discovert_discover_routing_template'  ">
              	<a ng-href="?id=discovertasker_newtask&table={{rl.table}}&sys_id=-1&query=parent={{data.sys_id}}" ng-class="{disabled: c.allowSubTask == false}" class="btn btn-primary action-btn pull-right ng-scope" role="button">New</a>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div ng-if="data.table == 'x_153465_discovert_route_task_instance'" class="tab-pane" id="TicketAudit">
      	<div style="margin-top: -1px;">
          <sp-widget widget="data.widgetInstanceAuditNotes"></sp-widget>
        </div>
      </div>
      
    </div>
      
  <!--/div-->
  <!-- End KTorres related lists -->
      
      <!-- performance debug -->
      <div ng-if="data.show_sql">
        <div class="comment">
          <span ng-if="data.f._perf.sql_count">${SQL Statements {{data.f._perf.sql_count}}}, </span>
          <span>${Time {{data.f._perf.time}}}</span>
        </div>
        <div ng-repeat="s in data.f._perf.sql" class="{{s.type}}">
          {{s.statement}}
        </div>
      </div>
      <!-- attachments -->
      <!--sp-attachment-manager table="data.table" sys-id="data.f._attachmentGUID" omit-edit="!data.canAttach"></sp-attachment-manager-->
      <!-- form -->
      <!--div>
        <sp-model form_model="data.f" mandatory="mandatory"></sp-model>
      </div-->
      
      <!-- UI Action Links -->
      <!--
			<div ng-if="getUIActions('link').length > 0">
        <label style="margin: 0;">${Related Links}</label>
        <div ng-repeat="action in getUIActions('link')">
          <a href ng-click="triggerUIAction(action)">{{action.name}}</a>
        </div>
      </div>
      -->

    </div>

    <div class="panel-footer">
      <div class="classification-banner-{{data.f.classification}}" ng-show="data.f.classification.length > 0"> 
      	<span class="glyphicon glyphicon-tag" title="Classification"></span>&nbsp;&nbsp;<span title="Classification">{{data.f.classification}}</span><br>
    	</div>
         
      <!-- Original: -->
      <!--
 			<button ng-click="triggerUIAction(action)" ng-disabled="submitting" ng-repeat="action in getUIActions('button')" class="btn btn-default action-btn" gsft_id="{{::action.sys_id}}">{{action.name}}</button>
      <span>{{status}}</span>
      <button ng-if="getPrimaryAction()" type="submit" ng-click="triggerUIAction(getPrimaryAction())" ng-disabled="submitting" class="btn btn-primary action-btn pull-right" gsft_id="{{::getPrimaryAction().sys_id ? getPrimaryAction().sys_id : ''}}">${Save} <span ng-if="saveButtonSuffix">(${{{saveButtonSuffix}}})</span></button>
      -->
			<button ng-if="getPrimaryAction() && data.sys_id.length > 2" type="submit" ng-click="triggerUIAction(getPrimaryAction())" ng-disabled="submitting" class="btn btn-default action-btn" gsft_id="{{::getPrimaryAction().sys_id ? getPrimaryAction().sys_id : ''}}">Update<span ng-if="saveButtonSuffix"></span></button>
      <!--
      <button ng-if="action.name.includes('Request') || action.name.includes('Reject')" ng-click="c.openModal(action)" ng-repeat="action in getUIActions('button')" class="btn btn-danger action-btn">{{action.name}}</button>
      <button ng-if="!action.name.includes('Request') && !action.name.includes('Reject')" ng-click="triggerUIAction(action)" ng-repeat="action in getUIActions('button')" class="btn btn-success action-btn">{{action.name}}</button>
			-->
      <button ng-click="triggerUIAction(action)" ng-disabled="submitting" ng-repeat="action in getUIActions('button')" class="btn btn-primary action-btn" gsft_id="{{::action.sys_id}}">{{action.name}}</button>
			<span>{{status}}</span>
      <!--
      <button ng-if="data.table == 'x_153465_discovert_suggested_taskers'" ng-click="createSuggestedTask()">
        Create Suggested Task
      </button>
-->
      <div style="clear: both;"></div>
      <div ng-if="mandatory.length" class="alert alert-info" style="margin-top: .5em" aria-live="polite" aria-atomic="true">
        <span ng-if="mandatory.length > 0">${Required information} </span>
        <span ng-repeat="f in mandatory" class="label label-danger" style="margin-right: .5em; display: inline-block;" ng-bind="f.label"></span>
      </div>
    </div>
  </div>
</div>

<script>
  /*
$(document).ready(function(){
    $(".nav-tabs a").click(function(){
        $(this).tab('show');
    });
    $('.nav-tabs a').on('shown.bs.tab', function(event){
        var x = $(event.target).text();         // active tab
        var y = $(event.relatedTarget).text();  // previous tab
        $(".act span").text(x);
        $(".prev span").text(y);
    });
});*/
</script>
]]></template>
    </sp_widget>
</record_update>
